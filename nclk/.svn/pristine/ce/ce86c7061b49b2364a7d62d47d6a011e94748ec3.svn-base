package cn.com.sparknet.nclk.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;

import cn.com.sparknet.nclk.dao.DashboardDao;
import cn.com.sparknet.nclk.service.DashboardService;
import cn.com.sparknet.common.util.JsonUtil;

/**
 * 首页echarts数据
 * @author lirj
 *
 */
@Service
public class DashboardServiceImpl implements DashboardService{
	
	@Resource
	private DashboardDao dashboardDao;
	
	@Override
	public String jsonErrorType(String errorType){
		String json = null;
		// 将数据转换成Json格式
		try {
			json = JsonUtil.listToJson(dashboardDao.listErrorType());
		} catch (Exception e) {
			throw new RuntimeException(e.getMessage(),e);
		}
		return json;
	}
	
//	@Override
//	public String jsonErrorType(String errorType){
//		List<Map<String, Object>> list = dashboardDao.listErrorType();
//		//拼接json数据
//		StringBuffer sb = new StringBuffer(errorType+"([");
//		for (int i = 0; i < list.size(); i++) {
//			sb.append("{\"ERROR_TYPE\":\""+list.get(i).get("ERROR_TYPE")+"\"},");
//		}
//		sb.append("])");
//		
//		return sb.toString();
//	}
	@Override
	public String jsonErrorTypeForEcharts(String errorType){
		Map<String, Integer> map = new HashMap<String, Integer>();
		// 计算同一错误出现的次数
		for (Map<String, Object> obj:dashboardDao.listErrorType()) {
			// obj.values()和obj.values().toString() -> "[String]"
			// objString -> "String"
			String objString = obj.values().toString();
			objString = objString.substring(1, objString.length()-1);
			
			if (map.containsKey(objString)) {
				map.put(objString, map.get(objString).intValue() + 1);
			} else {
				map.put(objString, 1);
			}
		}
//		System.out.println(map);
		
		
		String json = null;
		// 将数据转换成Json格式
		try {
			json = JsonUtil.mapToJson(map);
		} catch (Exception e) {
			throw new RuntimeException(e.getMessage(),e);
		}
		return json;
	}
	
}
