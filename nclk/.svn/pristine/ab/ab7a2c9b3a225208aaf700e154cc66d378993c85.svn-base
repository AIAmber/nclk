require(['jquery','bootstrap-grid','Util','table-toolbar','bootstrap-dialog','ztree'],function($,bootstrapGrid,Util,toolbar,bootstrapDialog,ztree){
	var toolbarc = $(".table-toolbar").toolbar();
	var gridTable=$('#exampointerGrid').bootstrapGrid({
		url:Util.getPath()+'/EndPointController/findEndPoints',
		uniqueId:'ENDPOINT_ID',
		toolbarc:toolbarc,	
		customHeight:64,
		columns:[{
			checkbox:true
		},{
			visible:false,
			field:'ENDPOINT_ID',
			title:'主键',
		},{
			field:'ENDPOINT_NO',
			title:'考点编号',
			width:'12%',
		},{
			field:'ENDPOINT_NAME',
			title:'考点名称',
			width:'12%',
		},{
			field:'ENDPOINT_ADDR',
			title:'考点地址',
			width:'20%',
		},{
			field:'ENDPOINT_IP',
			title:'考点服务器IP',
			width:'12%',
		},{
			field:'ENDPOINT_PORT',
			title:'考点服务器端口',
			width:'12%',
		},{
			field:'ENDPOINT_PERSON',
			title:'考点负责人',
			width:'10%',
		},{
			field:'ENDPOINT_TEL',
			title:'考点负责人电话',
			width:'12%',
		},{
			field:'ENDPOINT_ID',
			title:'操作',
			formatter:function(value,row,index){
				return[
					'<a class="table-operation table-operation-edit fa fa-pencil-square-o" href="javascript:void(0)" title="修改"></a>',
					'<a data-id="'+value+'" class="table-delete table-operation table-operation-del fa fa-trash-o" href="javascript:void(0)" title="删除"></a>'
				].join('');
			}
		}]
	});
	var exampointerDialog=new bootstrapDialog({
		title:'新增考点管理',
		type:'type-default',
		message:$('#exampointerAddForm'),
		closeByBackdrop: false,
        closeByKeyboard: false,
        autodestroy:false,
        draggable:true,
        cssClass:'exampointerDialog',
        buttons: [{
        	id:'exampointerBtn',
            label: '保存',
            autospin: false,
            icon: 'glyphicon glyphicon-check',    
            cssClass:' btn-success btn-sm',
            action: function(dialogRef){
            	if(!exampointerAddInfo.valid()){
            		validator.focusInvalid();
            		return;
            	}
            	exampointerAddInfo[0].reset();
            	dialogRef.close();
            }
        },{
            label: '取消',
            autospin: false,
            icon:'glyphicon glyphicon-remove',
            cssClass:' btn-default btn-sm',
            action: function(dialogRef){
            	exampointerAddInfo[0].reset();
            	validator.resetForm();
            	dialogRef.close();
            }
        }]
	});
	$('#btn-add').on('click',function(){
		exampointerDialog.open();
	});
	
	var exampointerAddInfo=$('#exampointerAddForm');
	var  validator=Util.validate('exampointerAddForm',{
		rules:{
			examName:{
				required:true
			},
			examNum:{
				required:true
			},
			examAddress:{
				required:true
			},
			examIPAddress:{
				required:true
			},
			examPort:{
				required:true
			},
			examPerson:{
				required:true
			},
			examPhone:{
				required:true
			},
			number:{
				required:true
			}
		},
		messages:{
			examName:{
				required:"请输入考点名称"
			},
			examNum:{
				required:"请输入考点编号"
			},
			examAddress:{
				required:"请输入考点地址"
			},
			examIPAddress:{
				required:"请输入考点服务器IP"
			},
			examPort:{
				required:"请输入考点服务器端口"
			},
			examPerson:{
				required:"请输入考点负责人"
			},
			examPhone:{
				required:"请输入考点负责人电话"
			},
			number:{
				required:"请输入顺序号"
			}
		}
	})
	
	
	
	function getPath(){
		return location.pathname.match(/\/(.+?)(?=\/)/g)[0];
	}
	
	//所属区域省市区三级联动
	$(document).ready(function(){
		//页面加载完成之后先通过getjson方法获取所有的省份数据
		//第一个参数为请求的url callBack为固定参数，  第二个参数为回调函数
		$.getJSON(getPath()+"/AreaController/getProvince?callBack=?",function(res){
			//通过jquery的each方法遍历res
			//Option(text, value, defaultSelected, selected)
			$("#province").append(new Option("请选择省",'',true,true));
			$.each(res,function(index,item){
				//查询元素，并且添加option
				$("#province").append(new Option(item.AREA_NAME,item.AREA_ID,false,false));
			});
			//添加完成之后触发选择事件
			$("#province").change();
		});
		
	});
	
	//给省份的选择框添加事件
	$("#province").change(function(){
		//获取选择的省份id
		var parentAreaId = $(this).val();
		//和请求省份一样，通过getjson请求城市
		//第一个参数为请求的url callBack为固定参数，第二个参数为需要传递的参数,  第三个参数为回调函数
		$.getJSON(getPath()+"/AreaController/getCity?callBack=?",{parentAreaId:parentAreaId},function(res){
			//清空城市选择看
			$("#city").empty();
			//通过jquery的each方法遍历res
			//Option(text, value, defaultSelected, selected)
			$("#city").append(new Option("请选择市",'',true,true));
			$.each(res,function(index,item){
				//查询元素，并且添加option
				$("#city").append(new Option(item.AREA_NAME,item.AREA_ID,false,false));
			});
			//添加完成之后触发选择事件
			$("#city").change();
		});
	});
	
	//给地级市的选择框添加事件
	$("#city").change(function(){
		//获取选择的省份id
		var parentAreaId = $(this).val();
		//和请求省份一样，通过getjson请求城市
		//第一个参数为请求的url callBack为固定参数，第二个参数为需要传递的参数,  第三个参数为回调函数
		$.getJSON(getPath()+"/AreaController/getDistrict?callBack=?",{parentAreaId:parentAreaId},function(res){
			//清空城市选择看
			$("#district").empty();
			//通过jquery的each方法遍历res
			//Option(text, value, defaultSelected, selected)
			$("#district").append(new Option("请选择区县",'',true,true));
			$.each(res,function(index,item){
				//查询元素，并且添加option
				$("#district").append(new Option(item.AREA_NAME,item.AREA_ID,false,false));
			});
		});
	});
	
	//省市区三级联动
	$(document).ready(function(){
		//页面加载完成之后先通过getjson方法获取所有的省份数据
		//第一个参数为请求的url callBack为固定参数，  第二个参数为回调函数
		$.getJSON(getPath()+"/AreaController/getProvince?callBack=?",function(res){
			//通过jquery的each方法遍历res
			//Option(text, value, defaultSelected, selected)
			$("#area-province").append(new Option("请选择省",'',true,true));
			$.each(res,function(index,item){
				//查询元素，并且添加option
				$("#area-province").append(new Option(item.AREA_NAME,item.AREA_ID,false,false));
			});
			//添加完成之后触发选择事件
			$("#area-province").change();
		});
		
	});
	
	//给省份的选择框添加事件
	$("#area-province").change(function(){
		//获取选择的省份id
		var parentAreaId = $(this).val();
		//和请求省份一样，通过getjson请求城市
		//第一个参数为请求的url callBack为固定参数，第二个参数为需要传递的参数,  第三个参数为回调函数
		$.getJSON(getPath()+"/AreaController/getCity?callBack=?",{parentAreaId:parentAreaId},function(res){
			//清空城市选择看
			$("#area-city").empty();
			//通过jquery的each方法遍历res
			//Option(text, value, defaultSelected, selected)
			$("#area-city").append(new Option("请选择市",'',true,true));
			$.each(res,function(index,item){
				//查询元素，并且添加option
				$("#area-city").append(new Option(item.AREA_NAME,item.AREA_ID,false,false));
			});
			//添加完成之后触发选择事件
			$("#area-city").change();
		});
	});
	
	//给地级市的选择框添加事件
	$("#area-city").change(function(){
		//获取选择的省份id
		var parentAreaId = $(this).val();
		//和请求省份一样，通过getjson请求城市
		//第一个参数为请求的url callBack为固定参数，第二个参数为需要传递的参数,  第三个参数为回调函数
		$.getJSON(getPath()+"/AreaController/getDistrict?callBack=?",{parentAreaId:parentAreaId},function(res){
			//清空城市选择看
			$("#area-district").empty();
			//通过jquery的each方法遍历res
			//Option(text, value, defaultSelected, selected)
			$("#area-district").append(new Option("请选择区县",'',true,true));
			$.each(res,function(index,item){
				//查询元素，并且添加option
				$("#area-district").append(new Option(item.AREA_NAME,item.AREA_ID,false,false));
			});
		});
	});
	
	
	//删除
	$('#exampointerGrid').on('click','.table-operation-del',function(){
		//当前行数据的主键值
		var id = $(this).parent().find("a").attr('data-id');
		Util.questionDialog('确定删除数据？',function(dialog, result){
			if(result==true){
				dialog.close();
				Util.promptSuccessDialog('数据删除成功！');
			}else{
				dialog.close();
			}
		});
	});
	
	
	$("#btn-delete").click(function(){
		var items = gridTable.table('getSelections');
		if(items.length==0){
			Util.warningDialog('尚未选择数据，请选择！');
		}else{
			Util.questionDialog('确定删除数据？',function(dialog, result){
				if(result){
					//TODO　这里调用后台
					Util.promptSuccessDialog('删除用户信息成功！');
				}
				dialog.close();
			});
		}
	});
});