require(['jquery','bootstrap-grid','Util','table-toolbar','bootstrap-dialog','ztree'],function($,bootstrapGrid,Util,toolbar,bootstrapDialog,ztree){
	var toolbarc = $(".table-toolbar").toolbar();
	var gridTable=$('#userGrid').bootstrapGrid({
		url:Util.getPath()+'/manage/data/user.json',
		uniqueId:'id',
		toolbarc:toolbarc,	
		customHeight:64,
		columns:[{
			checkbox:true
		},{
			visible:false,
			field:'id',
			title:'主键'
		},{
			field:'perName',
			title:'姓名',
			width:'18%'
		},{
			field:'userName',
			title:'用户名',
			width:'18%'
		},{
			field:'authority',
			title:'权限',
			width:'18%',
			formatter:function(value,row,index){
	    		return "<a class='authoritySetting' href='javascript:void(0)'>权限设置</a>";
	    	}
		},{
			field:'password',
			title:'密码',
			width:'18%',
			formatter:function(value,row,index){
	    		return "<a class='changePassword' href='javascript:void(0)'>密码修改</a>";
	    	}
		},{
			field:'manageArea',
			title:'管辖区域',
			width:'18%',
			formatter:function(value,row,index){
	    		return "<a class='manageArea' href='javascript:void(0)'>管辖区域设置</a>";
	    	}
		},{
			field:'id',
			title:'操作',
			formatter:function(value,row,index){
				return[
					'<a class="table-operation table-operation-edit fa fa-pencil-square-o" href="javascript:void(0)" title="修改"></a>',
					'<a class="table-operation table-operation-del fa fa-trash-o" href="javascript:void(0)" title="删除"></a>'
				].join('');
			}
		}]
	});
	
	var userDialog=new bootstrapDialog({
		type:'type-default',
		message:$('#userAddForm'),
		closeByBackdrop: false,
        closeByKeyboard: false,
        autodestroy:false,
        draggable:true,
        cssClass:'userAddDialog',
        buttons: [{
        	id:'userBtn',
            label: '保存',
            autospin: false,
            icon: 'glyphicon glyphicon-check',    
            cssClass:' btn-success btn-sm',
            action: function(dialogRef){
         		userDialog.close();
            }
        },{
            label: '取消',
            autospin: false,
            icon:'glyphicon glyphicon-remove',
            cssClass:' btn-default btn-sm',
            action: function(dialogRef){
            	userDialog.close();
            }
        }]
	});
	
	$('#btn-add').on("click",function(){
		userDialog.setTitle("新增用户管理");
		userDialog.open();
	   });
	
	var passwordDialog=new bootstrapDialog({
		title:'修改密码',
		type:'type-default',
		message:$('#changePasswordForm'),
		closeByBackdrop: false,
        closeByKeyboard: false,
        autodestroy:false,
        draggable:true,
        cssClass:'passwordDialog',
        buttons: [{
        	id:'passwordBtn',
            label: '保存',
            autospin: false,
            icon: 'glyphicon glyphicon-check',    
            cssClass:' btn-success btn-sm',
            action: function(dialogRef){
         		passwordDialog.close();
            }
        },{
            label: '取消',
            autospin: false,
            icon:'glyphicon glyphicon-remove',
            cssClass:' btn-default btn-sm',
            action: function(dialogRef){
            	passwordDialog.close();
            }
        }]
		
	}); 
	$('.changePassword').on('click',function(){
		passwordDialog.open();
	});
	
	var authorityDialog=new bootstrapDialog({
		title:'权限设置',
		type:'type-default',
		message:$('#authorityForm'),
		closeByBackdrop: false,
        closeByKeyboard: false,
        autodestroy:false,
        draggable:true,
        cssClass:'authorityDialog',
        buttons: [{
        	id:'authorityBtn',
            label: '保存',
            autospin: false,
            icon: 'glyphicon glyphicon-check',    
            cssClass:' btn-success btn-sm',
            action: function(dialogRef){
         		authorityDialog.close();
            }
        },{
            label: '取消',
            autospin: false,
            icon:'glyphicon glyphicon-remove',
            cssClass:' btn-default btn-sm',
            action: function(dialogRef){
            	authorityDialog.close();
            }
        }]
		
	}); 
	$('.authoritySetting').on('click',function(){
		authorityDialog.open();
	});
	
	//管辖区域树
	var manageArea =$('#manageArea');
	var setting = {
			view:{
				dblClickExpand: true
			},
			async: {
				enable: true,
				url:Util.getPath()+"/manage/data/tree.json",
				dataFilter: function(treeId, parentNode, childNodes){
					return childNodes.rows;
				}
			}, 
			data: {
			    simpleData: {
			        enable: true
			    }
			},
			check:{
				enable: true,
				chkStyle: "checkbox",
				chkboxType: { "Y": "ps", "N": "ps" }
			},
        };
	 $.fn.zTree.init($('#manageArea-treeContent'),setting);
	 
	 $('.dropdown-menu').on('click', '[data-stopPropagation]', function(e) {
	        e.stopPropagation();
	    });
});